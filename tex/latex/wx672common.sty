\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{wx672common}

\RequirePackage{ifxetex} % This class can only be processed with XeTeX

\RequirePackage{graphicx}
\graphicspath{{./figs/}{../figs/}{./img/}{./}{../}} %note that the trailing “/” is required

\RequirePackage{latexsym,pifont,units,amsmath,amsfonts,amssymb,marvosym,mathtools}

\RequirePackage[tt=false]{libertine} % keyboard symbol

\RequirePackage[font=footnotesize,labelfont=bf]{caption}

\RequirePackage{multicol,rotating,soul,tabu,varwidth}
\setul{1.5pt}{.4pt}% 1.5pt below contents
\setulcolor{gray}

\RequirePackage{xltxtra} %fontspec,xunicode are loaded here.
\defaultfontfeatures{Mapping=tex-text}
\setsansfont{DejaVu Sans}
\setmainfont{DejaVu Serif}

\RequirePackage{xeCJK}
\xeCJKDeclarePunctStyle{ mine }
{
  min-bound-to-kerning    = true,
  kerning-margin-minimum  = .2em,
}
\xeCJKsetup{PunctStyle=mine}
\xeCJKsetwidth{“”《》、（）}{1.2ex}
\xeCJKsetkern{：}{（}{1ex}
\xeCJKsetkern{；}{（}{1ex}

\setCJKmainfont[BoldFont={Adobe Heiti Std}]{Adobe Song Std}
\setCJKsansfont{Noto Sans CJK SC Regular}
\setCJKmonofont{Noto Sans Mono CJK SC Regular}
\setCJKfamilyfont{hei}{Adobe Heiti Std}
\setCJKfamilyfont{song}{Adobe Song Std}
\setCJKfamilyfont{kai}{Adobe Kaiti Std} % e.g. \CJKfamily{kai}

\newfontfamily\humor{Humor Sans}
\newfontfamily\purisa{Purisa}
\newfontfamily\dejavu{DejaVu Sans Mono}
\newCJKfontfamily\quotefont{Adobe Kaiti Std}

\RequirePackage{xcolor} % must before hyperref
\definecolor{Green}{cmyk}{1,0,1,.4}

\RequirePackage{hyperref}

\RequirePackage{parskip}

\RequirePackage{setspace}

\RequirePackage[backend=biber,url=false,hyperref=true,sorting=none,doi=false,isbn=false]{biblatex}

\newbibmacro{string+url}[1]{%
  \iffieldundef{url}{#1}{\href{\thefield{url}}{#1}}}
\DeclareFieldFormat{title}{\usebibmacro{string+url}{\mkbibemph{#1}}}
\DeclareFieldFormat[article]{title}{\usebibmacro{string+url}{\mkbibquote{#1}}}

% supercite
\DeclareCiteCommand{\supercite}[\mkbibsuperscript]
{\iffieldundef{prenote}
  {}
  {\BibliographyWarning{Ignoring prenote argument}}%
  \iffieldundef{postnote}
  {}
  {\BibliographyWarning{Ignoring postnote argument}}}
{\usebibmacro{citeindex}%
  \bibopenbracket\usebibmacro{cite}\bibclosebracket}
{\supercitedelim}
{}
\let\cite=\supercite

\RequirePackage[bottom]{footmisc} % stick footnote at bottom of page

\RequirePackage{minted} % minted has to be loaded at last!!!
\usemintedstyle{bw}

\DeclareOption{cn}{
  \renewcommand{\refname}{参考文献} % article.cls
  \renewcommand{\contentsname}{目\hspace{1em}录}
  \renewcommand{\listfigurename}{插图目录}
  \renewcommand{\listtablename}{表格目录}
  \renewcommand{\abstractname}{摘\hspace{1em}要}
  \renewcommand{\figurename}{图}
  \renewcommand{\tablename}{表}
  \renewcommand{\appendixname}{附\hspace{1em}录}
  \renewcommand{\indexname}{索\hspace{1em}引}
  \renewcommand{\listingscaption}{程序} % used by minted
  \renewcommand{\listoflistingscaption}{程序目录}
}

\ProcessOptions\relax

% use C-x 8 RET to input utf8 symbols
\newfontfamily\MyEmoji{Symbola}
\newcommand\Symbol[1]{\MyEmoji #1}
\newcommand\good{\MyEmoji ☺}
\newcommand\bad{\MyEmoji ☹}
\newcommand\danger{\MyEmoji ☠}
\newcommand\pointright{\MyEmoji ☞}

\renewcommand{\theFancyVerbLine}{
  \textcolor{lightgray}{\scriptsize \arabic{FancyVerbLine}}}
\newminted{gas}{ linenos=true,numbersep=2pt,fontsize=\footnotesize,
  frame=leftline,framesep=3pt,rulecolor=\color{lightgray}, xleftmargin=10pt }
\newminted{c}{ linenos=true,numbersep=2pt,fontsize=\footnotesize,
  frame=leftline,framesep=3pt,rulecolor=\color{lightgray}, xleftmargin=10pt }
\newminted{python}{ linenos=true,numbersep=2pt,fontsize=\footnotesize,
  frame=leftline,framesep=3pt,rulecolor=\color{lightgray}, xleftmargin=10pt }
\newcommand{\codec}[1]{\mintinline{c}|#1|}

\newcommand{\cfbox}[2]{%
  \colorlet{currentcolor}{.}%
  {\color{#1}\fbox{\color{currentcolor}#2}}%
}
\newcommand{\code}[1]{\texttt{\textcolor{violet}{#1}}}
\newcommand{\Navy}[1]{\textcolor{Navy}{#1}}

