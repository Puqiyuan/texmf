\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{wx672bib}

\RequirePackage{ifxetex} % This class can only be processed with XeTeX

% without this, the Chinese in bib files will cause compiling error.
\RequirePackage[utf8]{inputenc}
%%%%% biblatex %%%%%
\RequirePackage[backend=biber,%
date=edtf,seconds=true,% to suppress compile warnings
doi=false,isbn=false,url=false,eprint=false,%
style=caspervector,utf8,sorting=centy,% for chinese ("language = {chinese}" in bib file)
]{biblatex}

\renewcommand*{\bibfont}{\small} % 11pt

\DeclareFieldFormat*{year}{#1} % adjust caspervector to show year in non-bold style.
\DeclareFieldFormat*{url}{}% suppress url. it's a temp workaround until caspervector fix
                           % its bug
% https://tex.stackexchange.com/questions/23832/biblatex-make-title-hyperlink-to-doi-url-if-available
\newbibmacro{string+url}[1]{%
  \iffieldundef{url}{#1}{\href{\thefield{url}}{#1}}}

\DeclareFieldFormat{title}{\usebibmacro{string+url}{\mkbibemph{#1}}}
%\DeclareFieldFormat[article]{title}{\usebibmacro{string+url}{\mkbibquote{#1}}}

%%%%% caspervector provides \supercite already.
%%%%% keep the following for a safe backup.
% supercite
% \DeclareCiteCommand{\supercite}[\mkbibsuperscript]
% {\iffieldundef{prenote}
%   {}
%   {\BibliographyWarning{Ignoring prenote argument}}%
%   \iffieldundef{postnote}
%   {}
%   {\BibliographyWarning{Ignoring postnote argument}}}
% {\usebibmacro{citeindex}%
%   \bibopenbracket\usebibmacro{cite}\bibclosebracket}
% {\supercitedelim}
% {}
\let\cite=\supercite

%%%%% end biblatex %%%%%

